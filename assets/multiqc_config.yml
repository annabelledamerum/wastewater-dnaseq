intro_text: >
  This report has been generated by the <a href="https://github.com/Zymo-Research/aladdin-shotgun" target="_blank">Zymo-Research/aladdin-shotgun</a>
  analysis pipeline. For information about how to interpret these results, please see the
  <a href="https://zymo-research.github.io/pipeline-resources/report_docs/shotgun_documentation.html" target="_blank">report documentation</a>.
report_section_order:
  individ_alpha_barchart:
    before: Diversity_Analysis
  software_versions:
    order: -1001
  "Zymo-Research-aladdin-shotgun-summary":
    order: -1002
  mpa_readstats:
    before: bbduk
  kmer_composition:
    before: bbduk
  alpha_diversity:
    before: alpha_rarefaction
  beta_diversity:
    before: alpha_diversity
  comparative_alpha_diversity:
    before: comparative_alpha_rarefaction
  comparative_beta_diversity:
    before: comparative_alpha_diversity

export_plots: true

custom_content:
  order:
    - kmer_composition
    - mpa_readstats
    - Diversity_Analysis
    - Comparative_Diversity_Analysis
    - resistome_class_composition
    - top20genes_amr_composition

custom_data:
  alpha_diversity:
    anchor: "alpha_diversity"
    parent_id: Diversity_Analysis
    parent_name: "Diversity Analysis"
    section_name: "Alpha Diversity"
    description: "Alpha diversity is a measurement of the microbial diversity of each group. For analyses with group comparison, a box-and-whisker plot of observed species in each group is shown. Alpha diversity computed by different metrics can be found by clicking on the dropdown menu to the left of the plot."
    parent_description: "In this section, alpha diversity, alpha rarefaction, and beta diversity results by group are displayed in each subsection. Samples may be removed from diversity analysis for low read counts (default: 1,000 reads) or if samples belong to groups that lack any other replicates." 

  alpha_rarefaction:
    anchor: "alpha_rarefaction"
    parent_id: Diversity_Analysis
    parent_name: "Diversity Analysis"
    section_name: "Alpha Rarefaction"
    description: "This section shows an interactive alpha rarefaction plot, which is the alpha diversity (species richness) as a function of the sampling depth (sequencing read counts). Rarefaction is a technique to correct for uneven sampling when performing diversity analyses. Rarefaction curves can help to identify if sampling depth is sufficient to capture the true diversity of the community. Rarefaction curves are generated by randomly subsampling sequencing reads over a range of values and determining the alpha diversity at each read depth (at an average of 5 iterations). Curves computed by different metrics can be found by clicking on the dropdown menu to the left of the plot."
    parent_description: "In this section, alpha diversity, alpha rarefaction, and beta diversity results by group are displayed in each subsection. Samples may be removed from diversity analysis for low read counts (default: 1,000 reads) or if samples belong to groups that lack any other replicates."

  beta_diversity:
    anchor: "beta_diversity"
    parent_id: Diversity_Analysis
    parent_name: "Diversity Analysis"
    section_name: "Beta Diversity"
    description: "Beta diversity is a measurement of microbial diversity differences between samples. The figure below is the 3-dimensional principle coordinate analysis (PCoA) plot created using Bray-Curtis or Jaccard dissimilarity to calculate a matrix of paired-wise distances between samples. Use the dropdown menus below to access interactive 3-dimensional plots of beta diversity with different matrices. Each dot on the beta diversity plot represents the whole microbial composition profile. Samples with similar microbial composition profiles are closer to each other, while samples with different profiles are farther away from each other."
    parent_description: "In this section, alpha diversity, alpha rarefaction, and beta diversity results by group are displayed in each subsection. Samples may be removed from diversity analysis for low read counts (default: 1,000 reads) or if samples belong to groups that lack any other replicates."

  comparative_alpha_diversity:
    anchor: "comparative_alpha_diversity"
    parent_id: Comparative_Diversity_Analysis
    parent_name: "Comparative Diversity Analysis"
    parent_description: "In this section, a comparative diversity analysis has been conducted using the selected reference dataset. All diversity analyses have been recomputed to include the reference dataset, so results may appear differently than in the <a href='#Diversity_Analysis'>Diversity Analysis</a> section. Please note that comparisons across different studies should be interpreted with caution, as many different factors from sample collection, DNA isolation, library preparation and sequencing can impact the results obtained. We always try to use the original group labels for comparisons to the reference dataset. However, when original group labels are not provided or lack the replicates required for this comparison, we use 'user-samples' as the new group label for all user samples."
    section_name: "Alpha Diversity"
    description: "This section displays the alpha diversity of user and reference data, determined by the `Observed features` and `Shannon` diversity index metrics. Click on the icon for each group in the legend to hide or reveal samples."

  comparative_alpha_rarefaction:
    anchor: "comparative_alpha_rarefaction"
    parent_id: Comparative_Diversity_Analysis
    parent_name: "Comparative Diversity Analysis"
    parent_description: "In this section, a comparative diversity analysis has been conducted using the selected reference dataset. All diversity analyses have been recomputed to include the reference dataset, so results may appear differently than in the <a href='#Diversity_Analysis'>Diversity Analysis</a> section. Please note that comparisons across different studies should be interpreted with caution, as many different factors from sample collection, DNA isolation, library preparation and sequencing can impact the results obtained. We always try to use the original group labels for comparisons to the reference dataset. However, when original group labels are not provided or lack the replicates required for this comparison, we use 'user-samples' as the new group label for all user samples."
    section_name: "Alpha Rarefaction"
    description: "This section shows an interactive alpha rarefaction plot, which is the alpha diversity (species richness) as a function of the sampling depth (sequencing read counts), drawn from user and reference data. Reference data can be distinguished from your own data by the prefix `Ref_` added to group names, displayed in the legend to the right of the plot. Curves computed by different metrics can be found by clicking on the dropdown menu to the left of the plot."

  comparative_beta_diversity:
    anchor: "comparative_beta_diversity"
    parent_id: Comparative_Diversity_Analysis
    parent_name: "Comparative Diversity Analysis"
    parent_description: "In this section, a comparative diversity analysis has been conducted using the selected reference dataset. All diversity analyses have been recomputed to include the reference dataset, so results may appear differently than in the <a href='#Diversity_Analysis'>Diversity Analysis</a> section. Please note that comparisons across different studies should be interpreted with caution, as many different factors from sample collection, DNA isolation, library preparation and sequencing can impact the results obtained. We always try to use the original group labels for comparisons to the reference dataset. However, when original group labels are not provided or lack the replicates required for this comparison, we use 'user-samples' as the new group label for all user samples."
    section_name: "Beta Diversity"
    description: "This section displays the beta diversity of user and reference data, determined by the `Bray-Curtis` and `Jaccard` metrics. Click on the icon for each group in the legend to hide or reveal samples."

sp:
  alpha_diversity:
    fn: "alpha_diversity_mqc.html"
  beta_diversity:
    fn: "beta_diversity_mqc.html"
  alpha_rarefaction:
    fn: "alpha_rarefaction_mqc.html"
  comparative_beta_diversity:
    fn: "comparative_beta_diversity_mqc.html"
  comparative_alpha_rarefaction:
    fn: "comparative_alpha_rarefaction_mqc.html"
  comparative_alpha_diversity:
    fn: "comparative_alpha_diversity_mqc.html"
  resistome_class_composition:
    fn: "class_resistomechart_mqc.json"
  top20genes_amr_composition:
    fn: "genelevel_resistomechart_mqc.json"
  diamond:
    contents: "diamond v"
    num_lines: 10
  fastqc/data:
    fn_re: ".*(fastqc|falco)_data.txt$"
  fastqc/zip:
    fn: "*_fastqc.zip"

ignore_images: false

module_order:
  - fastqc:
      name: "FastQC / Falco (pre-Trimming)"
      anchor: "fastqc_raw"
      path_filters:
        - '*_raw_R1*fastqc*'
      path_filters_exclude:
        - "*_processed_R*fastqc*"
      extra: "If used in this run, Falco is a drop-in replacement for FastQC producing the same output, written by Guilherme de Sena Brandine and Andrew D. Smith."
  - fastp
  - adapterRemoval
  - porechop:
      extra: "ℹ️: if you get the error message 'Error - was not able to plot data.' this means that porechop did not detect any adapters and therefore no statistics generated."
  - fastqc:
      name: "FastQC / Falco (post-Trimming)"
      anchor: "fastqc_trimmed"
      path_filters:
        - '*_processed_R1*fastqc*'
      path_filters_exclude:
        - "*_raw_R*fastqc*"
      extra: "If used in this run, Falco is a drop-in replacement for FastQC producing the same output, written by Guilherme de Sena Brandine and Andrew D. Smith."
  - bbduk
  - prinseqplusplus
  - filtlong
  - bowtie2:
      name: "bowtie2"
      info: "In this pipeline, bowtie2 aligns sample reads to the host reference genome. Preferably, most reads in a microbiomics sample should not align to the host's genome. Any reads that align with the host are removed with bowtie2 from further analysis."
  - samtools:
      name: "Samtools Stats"
  - kraken:
      name: "Kraken"
      path_filters:
        - "*.kraken2.kraken2.report.txt"
  - kraken:
      name: "Bracken"
      anchor: "bracken"
      target: "Bracken"
      doi: "10.7717/peerj-cs.104"
      info: "Estimates species abundances in metagenomics samples by probabilistically re-distributing reads in the taxonomic tree."
      extra: "ℹ️: plot title will say Kraken2 due to the first step of bracken producing the same output format as Kraken. Abundance information is currently not supported in MultiQC."
      path_filters:
        - "*.bracken.kraken2.report.txt"
  - kraken:
      name: "Centrifuge"
      anchor: "centrifuge"
      target: "Centrifuge"
      doi: "10.1101/gr.210641.116"
      info: "is a very rapid and memory-efficient system for the classification of DNA sequences from microbial samples. The system uses a novel indexing scheme based on the Burrows-Wheeler transform (BWT) and the Ferragina-Manzini (FM) index. Note: Figure title"
      extra: "ℹ️: plot title will say Kraken2 due to Centrifuge producing the same output format as Kraken. If activated, see the actual Kraken2 results in the section above."
      path_filters:
        - "*.centrifuge.txt"
  - composition_barplots
  - interestgroup_comp
  - plot_heatmap
  - custom_content
  - metaquast:
      name: "MetaQUAST"
      anchor: "metaquast"
      info: "MetaQUAST evaluates genome assembly quality and provides several statistics."

#It is not possible to set placement for custom kraken and centrifuge columns.

table_columns_placement:
  FastQC / Falco (pre-Trimming):
    total_sequences: 100
    avg_sequence_length: 110
    median_sequence_length: 120
    percent_duplicates: 130
    percent_gc: 140
    percent_fails: 150
  fastp:
    pct_adapter: 200
    pct_surviving: 210
    pct_duplication: 220
    after_filtering_gc_content: 230
    after_filtering_q30_rate: 240
    after_filtering_q30_bases: 250
    filtering_result_passed_filter_reads: 260
  Adapter Removal:
    aligned_total: 260
    percent_aligned: 270
    percent_collapsed: 280
    percent_discarded: 290
  FastQC / Falco (post-Trimming):
    total_sequences: 300
    avg_sequence_length: 310
    median_sequence_length: 320
    percent_duplicates: 330
    percent_gc: 340
    percent_fails: 350
  Porechop:
    Input Reads: 400
    Start Trimmed: 410
    Start Trimmed Percent: 420
    End Trimmed: 430
    End Trimmed Percent: 440
    Middle Split: 450
    Middle Split Percent: 460
  Filtlong:
    Target bases: 500
  BBDuk:
    Input reads: 800
    Total Removed bases percent: 810
    Total Removed bases: 820
    Total Removed reads percent: 830
    Total Removed reads: 840
  PRINSEQ++:
    prinseqplusplus_total: 900
  bowtie2:
    overall_alignment_rate: 1000
  Samtools Stats:
    raw_total_sequences: 1100
    reads_mapped: 1110
    reads_mapped_percent: 1120
    reads_properly_paired_percent: 1130
    non-primary_alignments: 1140
    reads_MQ0_percent: 1150
    error_rate: 1160
  Bracken:
    "% Unclassified": 1200
    "% Top 5": 1210
  Centrifuge:
    "% Unclassified": 1300
    "% Top 5": 1310
  DIAMOND:
    queries_aligned: 1400
  Kaiju:
    assigned: 1500
    "% Assigned": 1510
    "% Unclassified": 1520
  Kraken:
    "% Unclassified": 1600
    "% Top 5": 1610
  MALT:
    "Num. of queries": 1700
    Total reads: 1710
    Mappability: 1720
    Assig. Taxonomy: 1730
    Taxonomic assignment success: 1740
  motus:
    Total number of reads: 1800
    Number of reads after filtering: 1810
    Total number of inserts: 1820
    Unique mappers: 1830
    Multiple mappers: 1840
    Ignored multiple mapper without unique hit: 1850
    "Number of ref-mOTUs": 1860
    "Number of meta-mOTUs": 1870
    "Number of ext-mOTUs": 1880
  sourmash:
    identified_kmers: 1900
  metaphlan4:
    identified_reads: 1900
  MetaQUAST:
    total_contigs: 100
    longest_contig: 110
    total_length: 120
    n50: 130
    gc_content: 140


table_columns_visible:
  FastQC / Falco (pre-Trimming):
    total_sequences: True
    avg_sequence_length: True
    median_sequence_length: False
    percent_duplicates: True
    percent_gc: True
    percent_fails: False
  FastQC / Falco (post-Trimming):
    total_sequences: True
    avg_sequence_length: False
    median_sequence_length: False
    percent_duplicates: False
    percent_gc: False
    percent_fails: False
  porechop:
    Input reads: False
    Start Trimmed:
    Start Trimmed Percent: True
    End Trimmed: False
    End Trimmed Percent: True
    Middle Split: False
    Middle Split Percent: True
  fastp:
    pct_adapter: False
    pct_surviving: True 
    pct_duplication: False
    after_filtering_gc_content: False
    after_filtering_q30_rate: False
    after_filtering_q30_bases: False
    filtering_result_passed_filter_reads: False
  Filtlong:
    Target bases: True
  Adapter Removal:
    aligned_total: True
    percent_aligned: True
    percent_collapsed: True
    percent_discarded: False
  BBDuk:
    Input reads: False
    Total Removed bases percent: False
    Total Removed bases: False
    Total Removed reads percent: True
    Total Removed reads: False
  "PRINSEQ++":
    prinseqplusplus_total: True
  bowtie2:
    overall_alignment_rate: True
  Samtools Stats:
    raw_total_sequences: True
    reads_mapped: True
    reads_mapped_percent: True
    reads_properly_paired_percent: False
    non-primary_alignments: False
    reads_MQ0_percent: False
    error_rate: False
  Kraken: False
  Bracken: False
  Centrifuge: False
  DIAMOND: False
  Kaiju: False
  MALT: False
  motus: False
  MetaQUAST:
    total_contigs: True
    longest_contig: True
    total_length: True
    n50: True
    gc_content: True

table_columns_name:
  FastQC / Falco (pre-Trimming):
    total_sequences: "No. Input Reads"
    avg_sequence_length: "Length Input Reads"
    percent_gc: "% GC Input Reads"
    percent_duplicates: "% Dups Input Reads"
    percent_fails: "% Failed Input Reads"
  fastp:
    pct_surviving: "% Pass QC Reads"
  FastQC / Falco (post-Trimming):
    total_sequences: "No. Processed Reads"
    avg_sequence_length: "Length Processed Reads"
    percent_gc: "% GC Processed Reads"
    percent_duplicates: "% Dups Processed Reads"
    percent_fails: "% Failed Processed Reads"
  BBDuk:
    Total Removed reads percent: "% Low-complexity Reads"
  Samtools Stats:
    raw_total_sequences: "Nr. Reads Into Mapping"
    reads_mapped: "Nr. Mapped Reads"
    reads_mapped_percent: "% Mapped Reads"
  MetaQUAST:
    total_contigs: "Total Contigs"
    longest_contig: "Longest Contig Length (bp)"
    total_length: "Total Length (bp)"
    n50: "N50"
    gc_content: "GC Content (%)"  

extra_fn_clean_exts:
  - "kraken2.report.txt"
  - ".txt"
  - ".settings"
  - ".bbduk"
  - ".unmapped"
  - type: regex
    pattern: "_filtered.log$"
    module: filtlong
  - type: truncate
    pattern: "_raw_R1.fastq.gz"
    module: fastqc_raw
  - type: truncate
    pattern: "_processed_R1.fastq.gz"
    module: fastqc_trimmed
  - type: truncate
    pattern: "_raw_R1_fastqc"
    module: fastqc_raw
  - type: truncate
    pattern: "_processed_R1_fastqc"
    module: fastqc_trimmed
  - type: truncate
    pattern: "_R1.fastp.fastq"
    module: bbduk

section_comments:
  general_stats: "By default, all read count columns are displayed as millions (M) of reads."
